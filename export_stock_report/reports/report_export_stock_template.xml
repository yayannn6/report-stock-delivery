<odoo>
  <template id="report_export_stock">
  <t t-call="web.html_container">
    <t t-foreach="results.items()" t-as="sp">
      <t t-set="sp_name" t-value="sp[0]"/>
      <t t-set="customers" t-value="sp[1]"/>
      <t t-call="web.external_layout">
        <div class="page">
          <div style="background:#d97c7c;color:#fff;text-align:center;font-weight:bold;padding:4px;">
            TOTAL STOK EXPORT <t t-esc="sp_name"/> <br/>
            PER TANGGAL <t t-esc="time.strftime('%d-%m-%Y')"/>
          </div>

          <t t-foreach="customers.items()" t-as="cust">
            <t t-set="cust_name" t-value="cust[0]"/>
            <t t-set="prod_data" t-value="cust[1]"/>

            <h4 style="text-align:center;">CUSTOMER : <t t-esc="cust_name"/></h4>

            <table border="1" style="width:100%;border-collapse:collapse;text-align:center;font-size:11px;">
              <thead>
                <tr>
                  <th rowspan="2">Product</th>
                  <t t-foreach="warehouses" t-as="wh">
                    <th colspan="2"><t t-esc="wh"/></th>
                  </t>
                  <th colspan="2">Total</th>
                </tr>
                <tr>
                  <t t-foreach="warehouses" t-as="wh">
                    <th>Box</th>
                    <th>Cont</th>
                  </t>
                  <th>Box</th>
                  <th>Cont</th>
                </tr>
              </thead>
              <tbody>
                <t t-foreach="products" t-as="prod">
                  <!-- Initialize box and cont total variables -->
                  <t t-set="total_box" t-value="0"/>
                  <t t-set="total_cont" t-value="0"/>
                  <tr>
                    <td><t t-esc="prod"/></td>
                    <t t-foreach="warehouses" t-as="wh">
                      <t t-set="vals" t-value="prod_data.get(prod, {}).get(wh, {})"/>
                      <td><t t-esc="vals.get('box', 0)"/></td>  <!-- Box di setiap warehouse -->
                      <td><t t-esc="vals.get('cont', 0)"/></td> <!-- Cont di setiap warehouse -->

                      <!-- Menambahkan nilai box dan cont ke total -->
                      <t t-set="total_box" t-value="total_box + vals.get('box', 0)"/>
                      <t t-set="total_cont" t-value="total_cont + vals.get('cont', 0)"/>
                    </t>

                    <!-- Menampilkan Total Box dan Cont -->
                    <td><t t-esc="total_box"/></td>  <!-- Total Box -->
                    <td><t t-esc="total_cont"/></td> <!-- Total Cont -->
                  </tr>
                </t>
              </tbody>
            </table>
            <br/>
          </t>
        </div>
      </t>
    </t>
  </t>
</template>

</odoo>
